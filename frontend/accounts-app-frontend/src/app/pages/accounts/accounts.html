<div class="page-container">
  <div class="page-header">
    <h2 class="page-header__title">Cuentas</h2>
  </div>
  <div class="toolbar">
    <div class="toolbar__search">
      <input 
        type="text" 
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        placeholder="Buscar cuenta..."
        class="toolbar__input"
      />
    </div>
    <button class="btn btn--primary" (click)="onNewAccount()">
      Nuevo
    </button>
  </div>
  <div class="table-container">
    <table class="data-table">
      <thead class="data-table__head">
        <tr class="data-table__head-row">
          <th class="data-table__header">Número</th>
          <th class="data-table__header">Tipo</th>
          <th class="data-table__header">Saldo</th>
          <th class="data-table__header">Estado</th>
          <th class="data-table__header">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr class="data-table__body-row" *ngFor="let account of accounts$ | async">
          <td class="data-table__cell">{{ account.accountNumber }}</td>
          <td class="data-table__cell">{{ account.accountType }}</td>
          <td class="data-table__cell">{{ account.initialBalance | currency }}</td>
          <td class="data-table__cell">
            <span [ngClass]="{'badge--active': account.status, 'badge--inactive': !account.status}" class="badge">
              {{ account.status ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <td class="data-table__cell">
            <div class="actions">
              <button class="actions__button" (click)="onEditAccount(account.id!)" title="Editar"><i class="fas fa-edit"></i></button>
              <button class="actions__button" (click)="onDeleteAccount(account.id!)" title="Eliminar"><i class="fas fa-trash"></i></button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="pagination">
    <button class="btn btn--secondary" (click)="onPreviousPage()" [disabled]="currentPage === 1">
      <i class="fas fa-minus"></i>
    </button>
    <span class="pagination__info">Página {{ currentPage }} de {{ totalPages }}</span>
    <button class="btn btn--secondary" (click)="onNextPage()" [disabled]="currentPage === totalPages">
      <i class="fas fa-plus"></i>
    </button>
  </div>

  <div *ngIf="showModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h3>{{ modalMode === 'create' ? 'Nueva Cuenta' : 'Editar Cuenta' }}</h3>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Número de Cuenta <span class="form-required">*</span></label>
          <input type="text" [(ngModel)]="formData.accountNumber" placeholder="Ej: 100001" class="form-input" required minlength="6" maxlength="20" />
          <small class="form-hint">6-20 caracteres alpanuméricos</small>
        </div>
        <div class="form-group">
          <label>Tipo de Cuenta <span class="form-required">*</span></label>
          <select [(ngModel)]="formData.accountType" class="form-input" required>
            <option value="">Seleccionar</option>
            <option value="AHORRO">Ahorro</option>
            <option value="CORRIENTE">Corriente</option>
          </select>
        </div>
        <div class="form-group">
          <label>Saldo Inicial <span class="form-required">*</span></label>
          <input type="number" [(ngModel)]="formData.initialBalance" placeholder="Ej: 5000.00" class="form-input" required min="0" />
          <small class="form-hint">Monto inicial (mínimo 0)</small>
        </div>
        <div class="form-group">
          <label>Cliente <span class="form-required">*</span></label>
          <select [(ngModel)]="formData.customerId" class="form-input" required>
            <option value="">Seleccionar Cliente</option>
            <option *ngFor="let client of clients$ | async" [value]="client.id!">
              {{ client.name }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" [(ngModel)]="formData.status" />
            Estado Activo
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn--secondary" (click)="onCloseModal()">Cancelar</button>
        <button class="btn btn--primary" (click)="onSaveAccount()">Guardar</button>
      </div>
    </div>
  </div>
</div>
